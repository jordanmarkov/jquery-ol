(function(){var $,$body,$document,$head,$html,$window,GeoLib,OlInteractions,OlParser,OlStyleParser,base,base1,base2,base3,base4,geoLib,root;root="undefined"!=typeof exports&&null!==exports?exports:this,$=jQuery,$window=$(window),$document=$(document),$html=$("html"),$head=$("head"),$body=$("body"),null==(base=String.prototype).startsWith&&(base.startsWith=function(a){return this.slice(0,a.length)===a}),null==(base1=String.prototype).endsWith&&(base1.endsWith=function(a){return""===a||this.slice(-a.length)===a}),null==(base2=String.prototype).trim&&(base2.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),null==(base3=Array.prototype).any&&(base3.any=function(a){var b,c,d;for(b=0,c=this.length;c>b;b++)if(d=this[b],a(d))return!0;return!1}),null==(base4=Array.prototype).all&&(base4.all=function(a){var b,c,d;for(b=0,c=this.length;c>b;b++)if(d=this[b],!a(d))return!1;return!0}),GeoLib=function(){function a(){}var b;return b=!1,a.prototype.loadCss=function(a){var b;0===$("link[href='"+a+"']").length&&(b=$("<link>",{rel:"stylesheet",type:"text/css"}),$head.append(b),b.attr({href:a}))},a.prototype.loadJs=function(a){var b,c;return b=$.Deferred(),this._olLoading?c=setInterval(function(a){return function(){a._olLoading||(clearInterval(c),b.resolve(a))}}(this),10):(this._olLoading=!0,$.ajax({url:a,dataType:"script",cache:!0,success:function(a){return function(c,d,e){return a._olLoading=!1,b.resolve(a)}}(this)})),b},a.prototype.loadOpenLayers=function(a,b){var c;return c=$.Deferred(),"undefined"==typeof ol||null===ol?(null==a&&(a="http://openlayers.org/en/v3.8.2/build/ol-debug.js"),null==b&&(b="http://openlayers.org/en/v3.8.2/css/ol.css"),setTimeout(function(d){return function(){return d.loadJs(a).done(function(){return c.resolve(ol)}),d.loadCss(b)}}(this),0)):c.resolve(ol),c},a.prototype.geocode=function(a){var b;return b=$.Deferred(),$.ajax({url:"http://nominatim.openstreetmap.org/search/",data:{q:a,format:"jsonv2",limit:1,extratags:1},dataType:"json",success:function(c,d,e){return c&&c.length>0?(console.info("Address '"+a+"' found"),b.resolve(c[0])):(console.warn("Address '"+a+"' not found"),b.reject(null))},error:function(c,d,e){return console.error("ajax error for '"+a+"': "+d+", "+e),b.reject(d)}}),b},a.prototype.createGUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b,c;return b=16*Math.random()|0,c="x"===a?b:3&b|8,c.toString(16)}).toUpperCase()},a}(),geoLib=new GeoLib,$.fn.setUniqueId=function(){var a,b;if(this.attr("id"))return this;for(b="";!b;)a=geoLib.createGUID(),0===$("#"+a).length&&(this.attr("id",a),b=a);return this},OlInteractions=function(){function OlInteractions(a){_map=a}var _deafultHoverOptions,_getFeatureTooltipText,_map,_popupFeature;return _map=null,_deafultHoverOptions={onTooltipAvailable:"",onPopupAvailabe:"pointer"},OlInteractions.prototype.dragCursor=function(){_map.on("moveend",function(a){$(_map.getTarget()).css({cursor:""})}),_map.on("pointerdrag",function(a){$(_map.getTarget()).css({cursor:"move"})}),_map.on("pointermove",function(a){a.dragging&&$(_map.getTarget()).css({cursor:"move"})})},OlInteractions.prototype.hoverCursor=function(a){var b;b=$.extend({},_deafultHoverOptions,a),_map.on("pointermove",function(a){var c,d;d=_map.getEventPixel(a.originalEvent),c=_map.forEachFeatureAtPixel(d,function(a,b){return a}),c?b.onTooltipAvailable&&c.get("tooltip")?$(_map.getTarget()).css({cursor:b.onTooltipAvailable}):b.onPopupAvailabe&&c.get("href")?$(_map.getTarget()).css({cursor:b.onPopupAvailabe}):$(_map.getTarget()).css({cursor:""}):$(_map.getTarget()).css({cursor:""})})},_popupFeature=null,OlInteractions.prototype.popups=function(){var a,b;a=$("<div>").appendTo($(_map.getTarget())),b=new ol.Overlay({element:a[0],positioning:"bottom-center",stopEvent:!1}),_map.addOverlay(b),_map.on("click",function(c){var d,e;e=_map.getEventPixel(c.originalEvent),d=_map.forEachFeatureAtPixel(e,function(a,b){return a}),d&&d.get("href")?$.ajax({url:d.get("href"),cache:!1,dataType:"html",success:function(e,f,g){var h,i;return h=$.parseHTML(e),h.length>1&&(h=$("<div>").html(h)),i=h.children("h1,h2,h3,h4,h5,h6").first(),i&&h.detach("h1:first,h2:first,h3:first,h4:first,h5:first,h6:first"),b.setPosition(c.coordinate),a.popover({placement:"top",html:!0,container:"body",content:h,title:i}),a.on("hidden.bs.modal",function(){return _popupFeature=null}),a.popover("show"),_popupFeature=d},error:function(b,c,d){return a.popover("destroy"),_popupFeature=null}}):(a.popover("destroy"),_popupFeature=null)})},_getFeatureTooltipText=function(feature){var fn,fnText,propName,tooltipTemplate;return feature.get("_tooltipFun")||(tooltipTemplate=feature.get("tooltip"),tooltipTemplate.startsWith("prop:")?(propName=tooltipTemplate.slice(5),feature.set("_tooltipFun",function(a){return a.get(propName)||""})):tooltipTemplate.startsWith("fn:")?(fnText=tooltipTemplate.slice(3),fn=eval("("+fnText+")"),feature.set("_tooltipFun",function(a){return fn.call(a,a)})):feature.set("_tooltipFun",function(a){return tooltipTemplate})),feature.get("_tooltipFun").call(feature,feature)},OlInteractions.prototype.tooltips=function(){var a,b;a=$("<div>").appendTo($(_map.getTarget())),a.css({position:"absolute"}),a.tooltip({animation:!1,delay:{show:0,hide:0},html:!0,placement:"top",trigger:"manual"}),b=null,_map.on("pointermove",function(c){var d,e,f;e=_map.getEventPixel(c.originalEvent),d=_map.forEachFeatureAtPixel(e,function(a,b){return a}),d&&d!==_popupFeature?(f=_getFeatureTooltipText(d),f?(a.css({left:e[0]+"px",top:e[1]-15+"px"}),a.attr({"data-original-title":f}),a.tooltip("fixTitle"),a.tooltip("show"),b=d):(a.tooltip("hide"),b=null)):(a.tooltip("destroy"),b=null)})},OlInteractions}(),OlStyleParser=function(){function a(){}var b;return b={},a.prototype._parseFillStyle=function(a){return null!=a&&0!==a.length?new ol.style.Fill({color:a.attr("color")||function(){throw new Error("Fill color is required")}()}):void 0},a.prototype._parseStrokeStyle=function(a){var b;return null!=a&&0!==a.length?(b={color:a.attr("color")||function(){throw new Error("Stroke color is required")}(),width:parseFloat(a.attr("width")||function(){throw new Error("Stroke width is required")}())},a.children("ol-property").each(function(){var a,c,d;return a=$(this).attr("name"),d=$(this).text(),d=function(){var b,e,f,g;switch(a){case"miterLimit":return parseFloat(d);case"lineCap":if("butt"===d||"round"===d||"square"===d)return d;throw new Error("Usupported lineCap value: '"+d+"'. Supported are 'butt', 'round' or 'square'.");case"lineJoin":if("bevel"===d||"round"===d||"miter"===d)return d;throw new Error("Usupported lineJoin value: '"+d+"'. Supported are 'bevel', 'round' or 'miter'.");case"lineDash":for(f=d.split(","),g=[],b=0,e=f.length;e>b;b++)c=f[b],g.push(parseFloat(c));return g;default:throw new Error("Usupported stroke property: '"+a+"'")}}(),b[a]=d}),new ol.style.Stroke(b)):void 0},a.prototype._getCircleProperties=function(a){var b;return b={radius:parseFloat(a.attr("radius"))||function(){throw new Error("Radius is required")}(),snaptopixel:"false"!==a.attr("snaptopixel"),fill:this._parseFillStyle(a.children("ol-fill")),stroke:this._parseStrokeStyle(a.children("ol-stroke"))}},a.prototype._getIconProperties=function(a){var b;return b={src:a.attr("src")||function(){throw new Error("Icon source is required")}(),snaptopixel:"false"!==a.attr("snaptopixel")},a.children("ol-property").each(function(){var a,c,d;return a=$(this).attr("name"),c=$(this).text(),c=function(){var b,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;switch(a){case"opacity":return parseFloat(c);case"anchor":for(l=c.split(","),p=[],b=0,h=l.length;h>b;b++)d=l[b],p.push(parseFloat(d));return p;case"offset":for(m=c.split(","),q=[],e=0,i=m.length;i>e;e++)d=m[e],q.push(parseFloat(d));return q;case"rotateWithView":return"false"!==c;case"size":for(n=c.split(","),r=[],f=0,j=n.length;j>f;f++)d=n[f],r.push(parseFloat(d));return r;case"imgSize":for(o=c.split(","),s=[],g=0,k=o.length;k>g;g++)d=o[g],s.push(parseFloat(d));return s;case"anchorOrigin":return c;case"anchorXUnits":return c;case"anchorYUnits":return c;case"crossOrigin":return c;case"offsetOrigin":return c;default:throw new Error("Usupported icon property: '"+a+"'")}}(),b[a]=c}),b},a.prototype._getRegularShapeProperties=function(a){var b;return b={radius:parseFloat(a.attr("radius"))||function(){throw new Error("Radius is required")}(),snaptopixel:"false"!==a.attr("snaptopixel"),fill:this._parseFillStyle(a.children("ol-fill")),stroke:this._parseStrokeStyle(a.children("ol-stroke"))},a.children("ol-property").each(function(){var a,c;return a=$(this).attr("name"),c=$(this).text(),c=function(){switch(a){case"points":return parseFloat(c);case"radius1":return parseFloat(c);case"radius2":return parseFloat(c);case"angle":return parseFloat(c);case"rotation":return parseFloat(c);default:throw new Error("Usupported regular shape property: '"+a+"'")}}(),b[a]=c}),b},a.prototype._parseImageStyle=function(a){if(null==a||0===a.length);else{if(1!==a.length)throw new Error("Expected exactly 1 image style, "+a.length+" given.");switch(a.attr("type")){case"circle":return new ol.style.Circle(this._getCircleProperties(a));case"icon":return new ol.style.Icon(this._getIconProperties(a));case"regular-shape":return new ol.style.RegularShape(this._getRegularShapeProperties(a));default:throw new Error("Usupported image type. Supported are 'circle', 'icon' or 'regular-shape'.")}}},a.prototype._parseSymbolizer=function(a){return new ol.style.Style({image:this._parseImageStyle(a.children("ol-image")),stroke:this._parseStrokeStyle(a.children("ol-stroke")),fill:this._parseFillStyle(a.children("ol-fill"))})},a.prototype._parseZoomStyle=function(a){var b;return b=function(){switch(!1){case!a.attr("lt"):return function(b){return b<parseFloat(a.attr("lt"))};case!a.attr("lte"):return function(b){return b<=parseFloat(a.attr("lte"))};case!a.attr("gt"):return function(b){return b>parseFloat(a.attr("gt"))};case!a.attr("gte"):return function(b){return b>=parseFloat(a.attr("gte"))};case!a.attr("eq"):return function(b){return b===parseFloat(a.attr("eq"))};case!a.attr("ne"):return function(b){return b!==parseFloat(a.attr("ne"))};default:throw new Error("None of the supported operators found: 'lt', 'lte', 'gt', 'gte', 'eq' or 'ne'.")}}(),{predicate:b,style:this._parseSymbolizer(a)}},a.prototype._parseStyle=function(a){var b;return b=[],a.children("ol-resolution").each(function(a){return function(c,d){return b.push(a._parseZoomStyle($(d)))}}(this)),b.push({predicate:function(a){return!0},style:this._parseSymbolizer(a)}),function(a,c){var d,e;return d=function(){var a,d,f;for(f=[],a=0,d=b.length;d>a;a++)e=b[a],e.predicate(c)&&f.push(e.style);return f}(),d.slice(0,1)}},a.prototype.parseStyles=function(a){return a.children("ol-style").each(function(a){return function(c,d){var e,f;e=$(d),f=e.attr("name")||function(){throw new Error("Style name is required")}(),b[f]=a._parseStyle(e)}}(this))},a.prototype.getStyle=function(a){if(a in b)return b[a];throw new Error("Unknown style name: '"+a+"'")},a}(),OlParser=function(){function a(){}var b,c,d,e,f;return f=new OlStyleParser,e="EPSG:3857",b="EPSG:4326",d=null,c=[],a.prototype._addLayer=function(a){return c.push(a)},a.prototype._isDomNode=function(a){return"object"==typeof Node?a instanceof Node:null!=a&&"object"==typeof a&&"number"==typeof a.nodeType&&"string"==typeof a.nodeName},a.prototype._isDomElement=function(a){return"object"==typeof HTMLElement?a instanceof HTMLElement:null!=a&&"object"==typeof a&&1===a.nodeType&&"string"==typeof a.nodeName},a.prototype._parseFixedStrategy=function(a){var c,d,f;return c=function(){var b,c,d,e;for(d=a.text().split(","),e=[],b=0,c=d.length;c>b;b++)f=d[b],e.push(parseFloat(f.trim()));return e}(),d=ol.proj.transformExtent(c,b,e),function(){return[d]}},a.prototype._parseVectorStrategy=function(a){var b,c;if(b=a.children("ol-strategy"),b.length>1)throw new Error("Expected 0 or 1 strategies, "+b.length+" given.");if(c=b,0===c.length||"all"===c.attr("type"))return ol.loadingstrategy.all;switch(c.attr("type")){case"bbox":return ol.loadingstrategy.bbox;case"fixed":return this._parseFixedStrategy(c);default:throw new Error("Usupported strategy type: '"+c.attr("type")+"'")}},a.prototype._parseGeoJsonSourceProperties=function(a){var b;return b={},a.children("ol-property").each(function(){var a,c;if(a=$(this).attr("name"),c=$(this).text(),!a)throw new Error("Property name cannot be empty in source ol-property");if(null!=b[a])throw new Error("Property name cannot be duplicated in source ol-property");return b[a]=c}),b},a.prototype._parseGeoJsonSource=function(a){var b,c,f,g,h,i,j;return null==a.attr("src")?(c=a.text(),h=new ol.source.Vector({features:(new ol.format.GeoJSON).readFeatures(JSON.parse(c),{dataProjection:a.attr("projection")||function(){throw new Error("'projection' is required for GeoJson layer")}(),featureProjection:e})}),h.oljq_refresh=function(){},h):(b=new ol.format.GeoJSON({defaultProjection:a.attr("projection")||function(){throw new Error("'projection' is required for GeoJson layer")}()}),j=this,f=function(c,d,f){var g,h,i;h=this,i=f.getCode(),c=c.any(function(a){return a===1/0||a===-(1/0)})?f.getExtent():c,g=$.extend({},h.getProperties(),{srs:i,extent:c.join(","),resolution:d}),$.ajax({url:a.attr("src"),data:g,cache:!1,dataType:"json",success:function(a,c,d){var f;return f=b.readFeatures(a,{dataProjection:b.defaultDataProjection,featureProjection:e}),h.addFeatures(f)},error:function(b,c,d){return console.error("ajax error for '"+a.attr("src")+"': "+c+", "+d)}})},i=this._parseVectorStrategy(a),h=new ol.source.Vector({loader:f,strategy:i,projection:e}),h.setProperties(j._parseGeoJsonSourceProperties(a)),null!=a.attr("refresh")&&(g=parseInt(a.attr("refresh"),10),g>0&&setInterval(function(){var a;return a=d.getView(),f.call(h,a.calculateExtent(d.getSize()),a.getResolution(),a.getProjection())},g)),h.oljq_refresh=function(){var a;null!=d&&(a=d.getView(),f.call(h,a.calculateExtent(d.getSize()),a.getResolution(),a.getProjection()))},h)},a.prototype._parseVectorSource=function(a){var b,c,d;if(b=a.children("ol-source"),1!==b.length)throw new Error("Expected exactly 1 source, "+b.length+" given.");if(c=b,"vector"!==c.attr("type"))throw new Error("Usupported vector source type: '"+c.attr("type")+"'");return d=function(){switch(c.attr("format")){case"geojson":return this._parseGeoJsonSource(c);case"inline":return this._parseInlineSource(c);default:throw new Error("Usupported vector source format type: '"+c.attr("format")+"'")}}.call(this),d.oljq_refresh=function(){},d},a.prototype._parseVectorLayer=function(a){var b;return b=a.attr("style-id"),new ol.layer.Vector({source:this._parseVectorSource(a),name:a.attr("name"),style:f.getStyle(b)})},a.prototype._parseMapQuestSource=function(a){var b,c;if(b=a.attr("layer"),"osm"!==b&&"sat"!==b&&"hyb"!==b)throw new Error("Unsupported MapQuest layer: '"+b+"'. Valid options are 'osm', 'sat' or 'hyb'.");return c=new ol.source.MapQuest({layer:b}),c.oljq_refresh=function(){},c},a.prototype._parseOSMSource=function(a){var b,c;return c=a.attr("url-format"),b=new ol.source.OSM({url:c}),b.oljq_refresh=function(){},b},a.prototype._parseTileSource=function(a){var b,c,d;if(b=a.children("ol-source"),1!==b.length)throw new Error("Expected exactly 1 source, "+b.length+" given.");return c=$(b[0]),d=function(){switch(c.attr("type")){case"mapQuest":return this._parseMapQuestSource(c);case"osm":return this._parseOSMSource(c);default:throw new Error("Usupported tile source type: '"+c.attr("type")+"'")}}.call(this),d.oljq_refresh=function(){},d},a.prototype._parseTileLayer=function(a){return new ol.layer.Tile({source:this._parseTileSource(a),name:a.attr("name")})},a.prototype._parseOlLayers=function(a){var b;return b=[],a.children("ol-layer").each(function(a){return function(c,d){var e,f;e=$(d),f=function(){switch(e.attr("type")){case"vector":return this._parseVectorLayer(e);case"tile":return this._parseTileLayer(e);default:throw new Error("Usupported layer type: '"+e.attr("type")+"'")}}.call(a),b.push(f),a._addLayer(f)}}(this)),b},a.prototype._parseView=function(a){var c,d,f,g;if(d=a.children("ol-view"),1!==d.length)throw new Error("Expected exactly 1 view, "+d.length+" given.");return c=$(d[0]),f={},c.children("ol-property").each(function(){var a,b,c;return b=$(this).attr("name"),c=$(this).text(),c=function(){var d,e,f,g,h,i,j,k,l,m,n,o;switch(b){case"center":for(j=c.split(","),m=[],d=0,g=j.length;g>d;d++)a=j[d],m.push(parseFloat(a));return m;case"constrainRotation":switch(c){case"true":return!0;case"false":return!1;default:return parseInt(c,10)}break;case"enableRotation":return"false"!==c;case"extent":for(k=c.split(","),n=[],e=0,h=k.length;h>e;e++)a=k[e],n.push(parseFloat(a));return n;case"maxResolution":return parseFloat(c);case"minResolution":return parseFloat(c);case"maxZoom":return parseInt(c,10);case"minZoom":return parseInt(c,10);case"projection":return c;case"resolution":return parseFloat(c);case"resolutions":for(l=c.split(","),o=[],f=0,i=l.length;i>f;f++)a=l[f],o.push(parseFloat(a));return o;case"rotation":return parseFloat(c);case"zoom":return parseInt(c,10);case"zoomFactor":return parseFloat(c);default:throw new Error("Usupported view property: '"+b+"'")}}(),f[b]=c}),e=f.projection=null!=(g=f.projection)?g:e,null!=f.center&&(f.center=ol.proj.transform(f.center,b,f.projection)),null!=f.extent&&(f.extent=ol.proj.transformExtent(f.extent,b,f.projection)),new ol.View(f)},a.prototype._getOlConfig=function(a){var b;return b=$.Deferred(),a.attr("src")?$.ajax({url:a.attr("src"),dataType:"xml",cache:!0,success:function(a,c,d){return b.resolve($(a).children("ol-configuration"))},error:function(a,c,d){return b.reject(c)}}):b.resolve($($.parseXML(a.children('script[type="application/xml"]').text())).children("ol-configuration")),b},a.prototype.getLayers=function(){return c.slice()},a.prototype.getVectorLayers=function(){var a,b,d,e;for(e=[],a=0,d=c.length;d>a;a++)b=c[a],b.get("source")instanceof ol.source.Vector&&e.push(b);return e},a.prototype.parseMap=function(a,c){var e;if(b=c.projection?c.projection:"EPSG:4326",e=function(){switch(!1){case!(a instanceof $):return a;case"string"!=typeof a:return $(""+a);case!this._isDomNode(a):return $(a);default:throw new Error("Unknown element")}}.call(this),0===e.length)throw new Error("Unknown element");return b=e.attr("projection")?e.attr("projection"):b,this._getOlConfig(e).then(function(a){return function(b){var c,g;f.parseStyles(b),g=new ol.Map({target:e[0],view:a._parseView(b),layers:a._parseOlLayers(b)}),d=g,c=new OlInteractions(g),c.dragCursor(),c.hoverCursor(),c.popups(),c.tooltips(),setTimeout(function(){return e.trigger({type:"jquery-ol.map.initialized",map:g})},10)}}(this))},a}(),function(){var a;a={init:function(a){var b,c,d;return d=$.extend({},$.fn.jqOpenLayers.defaults,a),b=$(this),c=new OlParser,b.data("JqOpenLayers",c),c.parseMap(b,d),b},getLayers:function(){var a,b;return a=$(this),b=a.data("JqOpenLayers"),b.getLayers()},getVectorLayers:function(){var a,b;return a=$(this),b=a.data("JqOpenLayers"),b.getVectorLayers()}},$.fn.jqOpenLayers=function(b){var c;if(c=arguments,a[b]&&"init"!==a[b]){if(1===$(this).length)return a[b].apply(this,Array.prototype.slice.call(c,1));$.error("Cannot invoke the method '"+b+"' on multiple elements")}return geoLib.loadOpenLayers().then(function(c){return function(){return c.each(function(){return"object"==typeof b||!b||a[b]&&"init"===a[b]?a.init.apply(this,b):$.error("The method '"+b+"' does not exist on jQuery.jqOpenLayers")})}}(this)),$(this)},$.fn.jqOpenLayers.defaults={projection:null,enablePopups:!1,enableTooltips:!1,onLayerAdded:null,onLayerLoaded:null}}()}).call(this);
//# sourceMappingURL=jquery-ol.min.js.map