(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;p="undefined"!=typeof exports&&null!==exports?exports:this,a=jQuery,f=a(window),c=a(document),e=a("html"),d=a("head"),b=a("body"),null==(j=String.prototype).startsWith&&(j.startsWith=function(a){return this.slice(0,a.length)===a}),null==(k=String.prototype).endsWith&&(k.endsWith=function(a){return""===a||this.slice(-a.length)===a}),null==(l=String.prototype).trim&&(l.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),null==(m=Array.prototype).any&&(m.any=function(a){var b,c,d;for(b=0,c=this.length;c>b;b++)if(d=this[b],a(d))return!0;return!1}),null==(n=Array.prototype).all&&(n.all=function(a){var b,c,d;for(b=0,c=this.length;c>b;b++)if(d=this[b],!a(d))return!1;return!0}),g=function(){function b(){}var c;return c=!1,b.prototype.loadCss=function(b){var c;0===a("link[href='"+b+"']").length&&(c=a("<link>",{rel:"stylesheet",type:"text/css"}),d.append(c),c.attr({href:b}))},b.prototype.loadJs=function(b){var c,d;return c=a.Deferred(),this._olLoading?d=setInterval(function(a){return function(){a._olLoading||(console.log("stop waiting..."),clearInterval(d),c.resolve(a))}}(this),10):(this._olLoading=!0,a.ajax({url:b,dataType:"script",cache:!0,success:function(a){return function(b,d,e){return a._olLoading=!1,c.resolve(a)}}(this)})),c},b.prototype.loadOpenLayers=function(b,c){var d;return d=a.Deferred(),"undefined"==typeof ol||null===ol?(null==b&&(b="http://openlayers.org/en/v3.8.2/build/ol-debug.js"),null==c&&(c="http://openlayers.org/en/v3.8.2/css/ol.css"),setTimeout(function(a){return function(){return a.loadJs(b).done(function(){return console.log("OpenLayers loaded "+ol),d.resolve(ol)}),a.loadCss(c)}}(this),0)):(console.log("OpenLayers already loaded"),d.resolve(ol)),d},b.prototype.geocode=function(b){var c;return c=a.Deferred(),a.ajax({url:"http://nominatim.openstreetmap.org/search/",data:{q:b,format:"jsonv2",limit:1,extratags:1},dataType:"json",success:function(a,d,e){return a&&a.length>0?(console.info("Address '"+b+"' found"),c.resolve(a[0])):(console.warn("Address '"+b+"' not found"),c.reject(null))},error:function(a,d,e){return console.error("ajax error for '"+b+"': "+d+", "+e),c.reject(d)}}),c},b.prototype.createGUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b,c;return b=16*Math.random()|0,c="x"===a?b:3&b|8,c.toString(16)}).toUpperCase()},b}(),o=new g,a.fn.setUniqueId=function(){var b,c;if(this.attr("id"))return this;for(c="";!c;)b=o.createGUID(),0===a("#"+b).length&&(this.attr("id",b),c=b);return this},i=function(){function b(){}var c;return c={},b.prototype._parseFillStyle=function(a){return null!=a&&0!==a.length?new ol.style.Fill({color:a.attr("color")||function(){throw"Fill color is required"}()}):void 0},b.prototype._parseStrokeStyle=function(b){var c;return null!=b&&0!==b.length?(c={color:b.attr("color")||function(){throw"Stroke color is required"}(),width:parseFloat(b.attr("width")||function(){throw"Stroke width is required"}())},b.children("ol-property").each(function(){var b,d,e;return b=a(this).attr("name"),e=a(this).text(),e=function(){var a,c,f,g;switch(b){case"miterLimit":return parseFloat(e);case"lineCap":if("butt"===e||"round"===e||"square"===e)return e;throw"Usupported lineCap value: '"+e+"'. Supported are 'butt', 'round' or 'square'.";case"lineJoin":if("bevel"===e||"round"===e||"miter"===e)return e;throw"Usupported lineJoin value: '"+e+"'. Supported are 'bevel', 'round' or 'miter'.";case"lineDash":for(f=e.split(","),g=[],a=0,c=f.length;c>a;a++)d=f[a],g.push(parseFloat(d));return g;default:throw"Usupported stroke property: '"+b+"'"}}(),c[b]=e}),new ol.style.Stroke(c)):void 0},b.prototype._getCircleProperties=function(a){var b;return b={radius:parseFloat(a.attr("radius"))||function(){throw"Radius is required"}(),snaptopixel:"false"!==a.attr("snaptopixel"),fill:this._parseFillStyle(a.children("ol-fill")),stroke:this._parseStrokeStyle(a.children("ol-stroke"))}},b.prototype._getIconProperties=function(b){var c;return c={src:b.attr("src")||function(){throw"Icon source is required"}(),snaptopixel:"false"!==b.attr("snaptopixel")},b.children("ol-property").each(function(){var b,d,e;return b=a(this).attr("name"),d=a(this).text(),d=function(){var a,c,f,g,h,i,j,k,l,m,n,o,p,q,r,s;switch(b){case"opacity":return parseFloat(d);case"anchor":for(l=d.split(","),p=[],a=0,h=l.length;h>a;a++)e=l[a],p.push(parseFloat(e));return p;case"offset":for(m=d.split(","),q=[],c=0,i=m.length;i>c;c++)e=m[c],q.push(parseFloat(e));return q;case"rotateWithView":return"false"!==d;case"size":for(n=d.split(","),r=[],f=0,j=n.length;j>f;f++)e=n[f],r.push(parseFloat(e));return r;case"imgSize":for(o=d.split(","),s=[],g=0,k=o.length;k>g;g++)e=o[g],s.push(parseFloat(e));return s;case"anchorOrigin":return d;case"anchorXUnits":return d;case"anchorYUnits":return d;case"crossOrigin":return d;case"offsetOrigin":return d;default:throw"Usupported icon property: '"+b+"'"}}(),c[b]=d}),c},b.prototype._getRegularShapeProperties=function(b){var c;return c={radius:parseFloat(b.attr("radius"))||function(){throw"Radius is required"}(),snaptopixel:"false"!==b.attr("snaptopixel"),fill:this._parseFillStyle(b.children("ol-fill")),stroke:this._parseStrokeStyle(b.children("ol-stroke"))},b.children("ol-property").each(function(){var b,d;return b=a(this).attr("name"),d=a(this).text(),d=function(){switch(b){case"points":return parseFloat(d);case"radius1":return parseFloat(d);case"radius2":return parseFloat(d);case"angle":return parseFloat(d);case"rotation":return parseFloat(d);default:throw"Usupported regular shape property: '"+b+"'"}}(),c[b]=d}),c},b.prototype._parseImageStyle=function(a){if(null==a||0===a.length);else{if(1!==a.length)throw"Expected exactly 1 image style, "+a.length+" given.";switch(a.attr("type")){case"circle":return new ol.style.Circle(this._getCircleProperties(a));case"icon":return new ol.style.Icon(this._getIconProperties(a));case"regular-shape":return new ol.style.RegularShape(this._getRegularShapeProperties(a));default:throw"Usupported image type. Supported are 'circle', 'icon' or 'regular-shape'."}}},b.prototype._parseSymbolizer=function(a){return new ol.style.Style({image:this._parseImageStyle(a.children("ol-image")),stroke:this._parseStrokeStyle(a.children("ol-stroke")),fill:this._parseFillStyle(a.children("ol-fill"))})},b.prototype._parseZoomStyle=function(a){var b;return b=function(){switch(!1){case!a.attr("lt"):return function(b){return b<parseFloat(a.attr("lt"))};case!a.attr("lte"):return function(b){return b<=parseFloat(a.attr("lte"))};case!a.attr("gt"):return function(b){return b>parseFloat(a.attr("gt"))};case!a.attr("gte"):return function(b){return b>=parseFloat(a.attr("gte"))};case!a.attr("eq"):return function(b){return b===parseFloat(a.attr("eq"))};case!a.attr("ne"):return function(b){return b!==parseFloat(a.attr("ne"))};default:throw"None of the supported operators found: 'lt', 'lte', 'gt', 'gte', 'eq' or 'ne'."}}(),{predicate:b,style:this._parseSymbolizer(a)}},b.prototype._parseStyle=function(b){var c;return c=[],b.children("ol-resolution").each(function(b){return function(d,e){return c.push(b._parseZoomStyle(a(e)))}}(this)),c.push({predicate:function(a){return!0},style:this._parseSymbolizer(b)}),function(a){return function(a,b){var d,e;return d=function(){var a,d,f;for(f=[],a=0,d=c.length;d>a;a++)e=c[a],e.predicate(b)&&f.push(e.style);return f}(),d.slice(0,1)}}(this)},b.prototype.parseStyles=function(b){return b.children("ol-style").each(function(b){return function(d,e){var f,g;f=a(e),g=f.attr("name")||function(){throw"Style name is required"}(),c[g]=b._parseStyle(f)}}(this))},b.prototype.getStyle=function(a){if(a in c)return c[a];throw"Unknown style name: '"+a+"'"},b}(),h=function(){function b(){}var c,d,e;return e=new i,d="EPSG:3857",c="EPSG:4326",b.prototype._isDomNode=function(a){return"object"==typeof Node?a instanceof Node:null!=a&&"object"==typeof a&&"number"==typeof a.nodeType&&"string"==typeof a.nodeName},b.prototype._isDomElement=function(a){return"object"==typeof HTMLElement?a instanceof HTMLElement:null!=a&&"object"==typeof a&&1===a.nodeType&&"string"==typeof a.nodeName},b.prototype._parseFixedStrategy=function(a){var b,e,f;return b=function(){var b,c,d,e;for(d=a.text().split(","),e=[],b=0,c=d.length;c>b;b++)f=d[b],e.push(parseFloat(f.trim()));return e}(),e=ol.proj.transformExtent(b,c,d),function(){return[e]}},b.prototype._parseVectorStrategy=function(a){var b,c;if(b=a.children("ol-strategy"),b.length>1)throw"Expected 0 or 1 strategies, "+b.length+" given.";if(c=b,0===c.length||"all"===c.attr("type"))return ol.loadingstrategy.all;switch(c.attr("type")){case"bbox":return ol.loadingstrategy.bbox;case"fixed":return this._parseFixedStrategy(c);default:throw"Usupported strategy type: '"+c.attr("type")+"'"}},b.prototype._parseGeoJsonSource=function(b){var c,e;return null==b.attr("src")?(e=b.text(),new ol.source.Vector({features:(new ol.format.GeoJSON).readFeatures(JSON.parse(e),{dataProjection:b.attr("projection")||function(){throw"'projection' is required for GeoJson layer"}(),featureProjection:d})})):(c=new ol.format.GeoJSON({defaultProjection:b.attr("projection")||function(){throw"'projection' is required for GeoJson layer"}()}),new ol.source.Vector({loader:function(d,e,f){var g,h;g=this,h=f.getCode(),d=d.any(function(a){return a===1/0||a===-(1/0)})?f.getExtent():d,a.ajax({url:b.attr("src"),data:{srs:h,extent:d.join(","),resolution:e},dataType:"json",success:function(a,b,d){var e;return console.log("loaded features"),console.log(a),e=c.readFeatures(a),g.addFeatures(e)},error:function(a,c,d){return console.error("ajax error for '"+b.attr("src")+"': "+c+", "+d)}})},strategy:this._parseVectorStrategy(b),projection:d}))},b.prototype._parseVectorSource=function(a){var b,c;if(b=a.children("ol-source"),1!==b.length)throw"Expected exactly 1 source, "+b.length+" given.";if(c=b,"vector"!==c.attr("type"))throw"Usupported vector source type: '"+c.attr("type")+"'";switch(c.attr("format")){case"geojson":return this._parseGeoJsonSource(c);case"inline":return this._parseInlineSource(c);default:throw"Usupported vector format type: '"+c.attr("format")+"'"}},b.prototype._parseVectorLayer=function(a){var b;return b=a.attr("style-id"),new ol.layer.Vector({source:this._parseVectorSource(a),name:a.attr("name"),style:e.getStyle(b)})},b.prototype._parseMapQuestSource=function(a){var b;if(b=a.attr("layer"),"osm"!==b&&"sat"!==b&&"hyb"!==b)throw"Unsupported MapQuest layer: '"+b+"'. Valid options are 'osm', 'sat' or 'hyb'.";return new ol.source.MapQuest({layer:b})},b.prototype._parseOSMSource=function(a){var b;return b=a.attr("url-format"),new ol.source.OSM({url:b})},b.prototype._parseTileSource=function(b){var c,d;if(c=b.children("ol-source"),1!==c.length)throw"Expected exactly 1 source, "+c.length+" given.";switch(d=a(c[0]),d.attr("type")){case"mapQuest":return this._parseMapQuestSource(d);case"osm":return this._parseOSMSource(d);default:throw"Usupported tile source type: '"+d.attr("type")+"'"}},b.prototype._parseTileLayer=function(a){return new ol.layer.Tile({source:this._parseTileSource(a),name:a.attr("name")})},b.prototype._parseOlLayers=function(b){var c;return c=[],b.children("ol-layer").each(function(b){return function(d,e){var f;f=a(e),c.push(function(){switch(f.attr("type")){case"vector":return this._parseVectorLayer(f);case"tile":return this._parseTileLayer(f);default:throw"Usupported layer type: '"+f.attr("type")+"'"}}.call(b))}}(this)),c},b.prototype._parseView=function(b){var e,f,g,h;if(f=b.children("ol-view"),1!==f.length)throw"Expected exactly 1 view, "+f.length+" given.";return e=a(f[0]),g={},e.children("ol-property").each(function(){var b,c,d;return c=a(this).attr("name"),d=a(this).text(),d=function(){var a,e,f,g,h,i,j,k,l,m,n,o;switch(c){case"center":for(j=d.split(","),m=[],a=0,g=j.length;g>a;a++)b=j[a],m.push(parseFloat(b));return m;case"constrainRotation":switch(d){case"true":return!0;case"false":return!1;default:return parseInt(d,10)}break;case"enableRotation":return"false"!==d;case"extent":for(k=d.split(","),n=[],e=0,h=k.length;h>e;e++)b=k[e],n.push(parseFloat(b));return n;case"maxResolution":return parseFloat(d);case"minResolution":return parseFloat(d);case"maxZoom":return parseInt(d,10);case"minZoom":return parseInt(d,10);case"projection":return d;case"resolution":return parseFloat(d);case"resolutions":for(l=d.split(","),o=[],f=0,i=l.length;i>f;f++)b=l[f],o.push(parseFloat(b));return o;case"rotation":return parseFloat(d);case"zoom":return parseInt(d,10);case"zoomFactor":return parseFloat(d);default:throw"Usupported view property: '"+c+"'"}}(),g[c]=d}),d=g.projection=null!=(h=g.projection)?h:d,null!=g.center&&(g.center=ol.proj.transform(g.center,c,g.projection)),null!=g.extent&&(g.extent=ol.proj.transformExtent(g.extent,c,g.projection)),new ol.View(g)},b.prototype._getOlConfig=function(b){var c;return c=a.Deferred(),b.attr("src")?a.ajax({url:b.attr("src"),dataType:"xml",cache:!0,success:function(b){return function(b,d,e){return c.resolve(a(b).children("ol-configuration"))}}(this),error:function(a){return function(a,b,d){return c.reject(b)}}(this)}):c.resolve(a(a.parseXML(b.children('script[type="application/xml"]').text())).children("ol-configuration")),c},b.prototype.parseMap=function(b,d){var f,g,h;if(c=d.projection?d.projection:"EPSG:4326",f=function(){switch(!1){case!(b instanceof a):return b;case"string"!=typeof b:return a(""+b);case!this._isDomNode(b):return a(b);default:throw"Unknown element"}}.call(this),0===f.length)throw"Unknown element";return c=f.attr("projection")?f.attr("projection"):c,g=a("<div>").appendTo(f),h=new ol.Overlay({element:g[0],positioning:"bottom-center",stopEvent:!1}),this._getOlConfig(f).then(function(b){return function(c){var d;return e.parseStyles(c),d=new ol.Map({target:f[0],view:b._parseView(c),layers:b._parseOlLayers(c)}),d.addOverlay(h),d.on("moveend",function(a){d.getTarget().style.cursor=""}),d.on("pointerdrag",function(a){d.getTarget().style.cursor="move"}),d.on("click",function(b){var c,e;e=d.getEventPixel(b.originalEvent),c=d.forEachFeatureAtPixel(e,function(a,b){return a}),c&&c.get("href")?a.ajax({url:c.get("href"),cache:!1,dataType:"html",success:function(c,d,e){var f,i;return f=a.parseHTML(c),f.length>1&&(f=a("<div>").html(f)),i=f.children("h1,h2,h3,h4,h5,h6").first(),i&&f.detach("h1:first,h2:first,h3:first,h4:first,h5:first,h6:first"),h.setPosition(b.coordinate),g.popover({placement:"top",html:"true",container:"body",content:f,title:i}),g.popover("show")},error:function(b,c,d){return $contentElement.html(a("<div>").attr({"class":"ol-popup-loading-error"}))}}):g.popover("destroy")}),d.on("pointermove",function(a){var b,c;a.dragging?d.getTarget().style.cursor="move":(c=d.getEventPixel(a.originalEvent),b=d.forEachFeatureAtPixel(c,function(a,b){return a}),b&&b.get("href")?d.getTarget().style.cursor="pointer":d.getTarget().style.cursor="")}),d}}(this))},b}(),function(){var b;b={init:function(b){var c,d,e;return e=a.extend({},a.fn.jqOpenLayers.defaults,b),c=a(this),d=new h,c.data("JqOpenLayers",d),d.parseMap(c,e),c}},a.fn.jqOpenLayers=function(c){var d;return d=arguments,o.loadOpenLayers().then(function(e){return function(){return e.each(function(){return b[c]?b[c].apply(this,Array.prototype.slice.call(d,1)):"object"!=typeof c&&c?a.error("The method '"+c+"' does not exist on jQuery.jqOpenLayers"):b.init.apply(this,c)})}}(this))},a.fn.jqOpenLayers.defaults={projection:null,enablePopups:!1,enableTooltips:!1,onLayerAdded:null,onLayerLoaded:null}}()}).call(this);
//# sourceMappingURL=jquery-ol.min.js.map