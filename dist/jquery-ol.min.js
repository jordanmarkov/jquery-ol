(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;p="undefined"!=typeof exports&&null!==exports?exports:this,a=jQuery,f=a(window),c=a(document),e=a("html"),d=a("head"),b=a("body"),null==(j=String.prototype).startsWith&&(j.startsWith=function(a){return this.slice(0,a.length)===a}),null==(k=String.prototype).endsWith&&(k.endsWith=function(a){return""===a||this.slice(-a.length)===a}),null==(l=String.prototype).trim&&(l.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),null==(m=String.prototype).trimStart&&(m.trimStart=function(a){return this.startsWith(a)?this.slice(a.length):this}),null==(n=String.prototype).trimEnd&&(n.trimEnd=function(a){return this.endsWith(a)?this.slice(0,-a.length):this}),g=function(){function b(){}var c;return c=!1,b.prototype.loadCss=function(b){var c;0===a("link[href='"+b+"']").length&&(c=a("<link>",{rel:"stylesheet",type:"text/css"}),d.append(c),c.attr({href:b}))},b.prototype.loadJs=function(b){var c,d;return c=a.Deferred(),this._olLoading?d=setInterval(function(a){return function(){a._olLoading||(console.log("stop waiting..."),clearInterval(d),c.resolve(a))}}(this),10):(this._olLoading=!0,a.ajax({url:b,dataType:"script",cache:!0,success:function(a){return function(b,d,e){return a._olLoading=!1,c.resolve(a)}}(this)})),c},b.prototype.loadOpenLayers=function(b,c){var d;return d=a.Deferred(),"undefined"==typeof ol||null===ol?(null==b&&(b="http://openlayers.org/en/v3.8.2/build/ol-debug.js"),null==c&&(c="http://openlayers.org/en/v3.8.2/css/ol.css"),setTimeout(function(a){return function(){return a.loadJs(b).done(function(){return console.log("OpenLayers loaded "+ol),d.resolve(ol)}),a.loadCss(c)}}(this),0)):(console.log("OpenLayers already loaded"),d.resolve(ol)),d},b.prototype.geocode=function(b){var c;return c=a.Deferred(),a.ajax({url:"http://nominatim.openstreetmap.org/search/",data:{q:b,format:"jsonv2",limit:1,extratags:1},dataType:"json",success:function(a,d,e){return a&&a.length>0?(console.info("Address '"+b+"' found"),c.resolve(a[0])):(console.warn("Address '"+b+"' not found"),c.reject(null))},error:function(a,d,e){return console.error("ajax error for '"+b+"': "+d+", "+e),c.reject(d)}}),c},b.prototype.createGUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b,c;return b=16*Math.random()|0,c="x"===a?b:3&b|8,c.toString(16)}).toUpperCase()},b}(),o=new g,a.fn.setUniqueId=function(){var b,c;if(this.attr("id"))return this;for(c="";!c;)b=o.createGUID(),0===a("#"+b).length&&(this.attr("id",b),c=b);return this},i=function(){function b(){}var c;return c={},b.prototype._parseFillStyle=function(a){return null!=a&&0!==a.length?new ol.style.Fill({color:a.attr("color")||function(){throw"Fill color is required"}()}):void 0},b.prototype._parseStrokeStyle=function(b){var c;return null!=b&&0!==b.length?(c={color:b.attr("color")||function(){throw"Stroke color is required"}(),width:parseFloat(b.attr("width")||function(){throw"Stroke width is required"}())},b.children("ol-property").each(function(){var b,d,e;return b=a(this).attr("name"),e=a(this).text(),e=function(){var a,c,f,g;switch(b){case"miterLimit":return parseFloat(e);case"lineCap":if("butt"===e||"round"===e||"square"===e)return e;throw"Usupported lineCap value: '"+e+"'. Supported are 'butt', 'round' or 'square'.";case"lineJoin":if("bevel"===e||"round"===e||"miter"===e)return e;throw"Usupported lineJoin value: '"+e+"'. Supported are 'bevel', 'round' or 'miter'.";case"lineDash":for(f=e.split(","),g=[],a=0,c=f.length;c>a;a++)d=f[a],g.push(parseFloat(d));return g;default:throw"Usupported stroke property: '"+b+"'"}}(),c[b]=e}),new ol.style.Stroke(c)):void 0},b.prototype._getCircleProperties=function(a){var b;return b={radius:parseFloat(a.attr("radius"))||function(){throw"Radius is required"}(),snaptopixel:"false"!==a.attr("snaptopixel"),fill:this._parseFillStyle(a.children("ol-fill")),stroke:this._parseStrokeStyle(a.children("ol-stroke"))}},b.prototype._getIconProperties=function(b){var c;return c={src:b.attr("src")||function(){throw"Icon source is required"}(),snaptopixel:"false"!==b.attr("snaptopixel")},b.children("ol-property").each(function(){var b,d,e;return b=a(this).attr("name"),d=a(this).text(),d=function(){var a,c,f,g,h,i,j,k,l,m,n,o,p,q,r,s;switch(b){case"opacity":return parseFloat(d);case"anchor":for(l=d.split(","),p=[],a=0,h=l.length;h>a;a++)e=l[a],p.push(parseFloat(e));return p;case"offset":for(m=d.split(","),q=[],c=0,i=m.length;i>c;c++)e=m[c],q.push(parseFloat(e));return q;case"rotateWithView":return"false"!==d;case"size":for(n=d.split(","),r=[],f=0,j=n.length;j>f;f++)e=n[f],r.push(parseFloat(e));return r;case"imgSize":for(o=d.split(","),s=[],g=0,k=o.length;k>g;g++)e=o[g],s.push(parseFloat(e));return s;case"anchorOrigin":return d;case"anchorXUnits":return d;case"anchorYUnits":return d;case"crossOrigin":return d;case"offsetOrigin":return d;default:throw"Usupported icon property: '"+b+"'"}}(),c[b]=d}),c},b.prototype._getRegularShapeProperties=function(b){var c;return c={radius:parseFloat(b.attr("radius"))||function(){throw"Radius is required"}(),snaptopixel:"false"!==b.attr("snaptopixel"),fill:this._parseFillStyle(b.children("ol-fill")),stroke:this._parseStrokeStyle(b.children("ol-stroke"))},b.children("ol-property").each(function(){var b,d;return b=a(this).attr("name"),d=a(this).text(),d=function(){switch(b){case"points":return parseFloat(d);case"radius1":return parseFloat(d);case"radius2":return parseFloat(d);case"angle":return parseFloat(d);case"rotation":return parseFloat(d);default:throw"Usupported regular shape property: '"+b+"'"}}(),c[b]=d}),c},b.prototype._parseImageStyle=function(a){if(null==a||0===a.length);else{if(1!==a.length)throw"Expected exactly 1 image style, "+a.length+" given.";switch(a.attr("type")){case"circle":return new ol.style.Circle(this._getCircleProperties(a));case"icon":return new ol.style.Icon(this._getIconProperties(a));case"regular-shape":return new ol.style.RegularShape(this._getRegularShapeProperties(a));default:throw"Usupported image type. Supported are 'circle', 'icon' or 'regular-shape'."}}},b.prototype._parseSymbolizer=function(a){return new ol.style.Style({image:this._parseImageStyle(a.children("ol-image")),stroke:this._parseStrokeStyle(a.children("ol-stroke")),fill:this._parseFillStyle(a.children("ol-fill"))})},b.prototype._parseZoomStyle=function(a){var b;return b=function(){switch(!1){case!a.attr("lt"):return function(b){return b<parseFloat(a.attr("lt"))};case!a.attr("lte"):return function(b){return b<=parseFloat(a.attr("lte"))};case!a.attr("gt"):return function(b){return b>parseFloat(a.attr("gt"))};case!a.attr("gte"):return function(b){return b>=parseFloat(a.attr("gte"))};case!a.attr("eq"):return function(b){return b===parseFloat(a.attr("eq"))};case!a.attr("ne"):return function(b){return b!==parseFloat(a.attr("ne"))};default:throw"None of the supported operators found: 'lt', 'lte', 'gt', 'gte', 'eq' or 'ne'."}}(),{predicate:b,style:this._parseSymbolizer(a)}},b.prototype._parseStyle=function(b){var c;return c=[],b.children("ol-resolution").each(function(b){return function(d,e){return c.push(b._parseZoomStyle(a(e)))}}(this)),c.push({predicate:function(a){return!0},style:this._parseSymbolizer(b)}),function(a){return function(a,b){var d,e;return d=function(){var a,d,f;for(f=[],a=0,d=c.length;d>a;a++)e=c[a],e.predicate(b)&&f.push(e.style);return f}(),d.slice(0,1)}}(this)},b.prototype.parseStyles=function(b){return b.children("ol-style").each(function(b){return function(d,e){var f,g;f=a(e),g=f.attr("name")||function(){throw"Style name is required"}(),c[g]=b._parseStyle(f)}}(this))},b.prototype.getStyle=function(a){if(a in c)return c[a];throw"Unknown style name: '"+a+"'"},b}(),h=function(){function b(){}var c,d;return d=new i,c="EPSG:3857",b.prototype._isDomNode=function(a){return"object"==typeof Node?a instanceof Node:null!=a&&"object"==typeof a&&"number"==typeof a.nodeType&&"string"==typeof a.nodeName},b.prototype._isDomElement=function(a){return"object"==typeof HTMLElement?a instanceof HTMLElement:null!=a&&"object"==typeof a&&1===a.nodeType&&"string"==typeof a.nodeName},b.prototype._parseGeoJsonSource=function(a){var b;return null==a.attr("src")?(b=a.text(),new ol.source.Vector({features:(new ol.format.GeoJSON).readFeatures(JSON.parse(b),{dataProjection:a.attr("projection")||function(){throw"'projection' is required for GeoJson layer"}(),featureProjection:c})})):new ol.source.Vector({format:new ol.format.GeoJSON({defaultProjection:a.attr("projection")||function(){throw"'projection' is required for GeoJson layer"}()}),url:a.attr("src")})},b.prototype._parseVectorSource=function(a){var b,c;if(b=a.children("ol-source"),1!==b.length)throw"Expected exactly 1 source, "+b.length+" given.";if(c=b,"vector"!==c.attr("type"))throw"Usupported vector source type: '"+c.attr("type")+"'";switch(c.attr("format")){case"geojson":return this._parseGeoJsonSource(c);case"inline":return this._parseInlineSource(c);default:throw"Usupported vector format type: '"+c.attr("format")+"'"}},b.prototype._parseVectorLayer=function(a){var b;return b=a.attr("style-id"),new ol.layer.Vector({source:this._parseVectorSource(a),name:a.attr("name"),style:d.getStyle(b)})},b.prototype._parseMapQuestSource=function(a){var b;if(b=a.attr("layer"),"osm"!==b&&"sat"!==b&&"hyb"!==b)throw"Unsupported MapQuest layer: '"+b+"'. Valid options are 'osm', 'sat' or 'hyb'.";return new ol.source.MapQuest({layer:b})},b.prototype._parseTileSource=function(b){var c,d;if(c=b.children("ol-source"),1!==c.length)throw"Expected exactly 1 source, "+c.length+" given.";switch(d=a(c[0]),d.attr("type")){case"mapQuest":return this._parseMapQuestSource(d);default:throw"Usupported tile source type: '"+d.attr("type")+"'"}},b.prototype._parseTileLayer=function(a){return new ol.layer.Tile({source:this._parseTileSource(a),name:a.attr("name")})},b.prototype._parseOlLayers=function(b){var c;return c=[],b.children("ol-layer").each(function(b){return function(d,e){var f;f=a(e),c.push(function(){switch(f.attr("type")){case"vector":return this._parseVectorLayer(f);case"tile":return this._parseTileLayer(f);default:throw"Usupported layer type: '"+f.attr("type")+"'"}}.call(b))}}(this)),c},b.prototype._parseView=function(b){var d,e,f,g;if(e=b.children("ol-view"),1!==e.length)throw"Expected exactly 1 view, "+e.length+" given.";return d=a(e[0]),f={},d.children("ol-property").each(function(){var b,c,d;return c=a(this).attr("name"),d=a(this).text(),d=function(){var a,e,f,g,h,i,j,k,l,m,n,o;switch(c){case"center":for(j=d.split(","),m=[],a=0,g=j.length;g>a;a++)b=j[a],m.push(parseFloat(b));return m;case"constrainRotation":switch(d){case"true":return!0;case"false":return!1;default:return parseInt(d,10)}break;case"enableRotation":return"false"!==d;case"extent":for(k=d.split(","),n=[],e=0,h=k.length;h>e;e++)b=k[e],n.push(parseFloat(b));return n;case"maxResolution":return parseFloat(d);case"minResolution":return parseFloat(d);case"maxZoom":return parseInt(d,10);case"minZoom":return parseInt(d,10);case"projection":return d;case"resolution":return parseFloat(d);case"resolutions":for(l=d.split(","),o=[],f=0,i=l.length;i>f;f++)b=l[f],o.push(parseFloat(b));return o;case"rotation":return parseFloat(d);case"zoom":return parseInt(d,10);case"zoomFactor":return parseFloat(d);default:throw"Usupported view property: '"+c+"'"}}(),f[c]=d}),c=f.projection=null!=(g=f.projection)?g:c,null!=f.center&&(f.center=ol.proj.transform(f.center,"EPSG:4326",f.projection)),null!=f.extent&&(f.extent=ol.proj.transformExtent(f.extent,"EPSG:4326",f.projection)),new ol.View(f)},b.prototype._getOlConfig=function(b){var c;return c=a.Deferred(),b.attr("src")?a.ajax({url:b.attr("src"),dataType:"xml",cache:!0,success:function(b){return function(b,d,e){return c.resolve(a(b).children("ol-configuration"))}}(this),error:function(a){return function(a,b,d){return c.reject(b)}}(this)}):c.resolve(a(a.parseXML(b.children('script[type="application/xml"]').text())).children("ol-configuration")),c},b.prototype.parseMap=function(b){var c,e,f;if(c=function(){switch(!1){case!(b instanceof a):return b;case"string"!=typeof b:return a(""+b);case!this._isDomNode(b):return a(b);default:throw"Unknown element"}}.call(this),0===c.length)throw"Unknown element";return e=a("<div>").appendTo(c),f=new ol.Overlay({element:e[0],positioning:"bottom-center",stopEvent:!1}),this._getOlConfig(c).then(function(b){return function(g){var h;return d.parseStyles(g),h=new ol.Map({target:c[0],view:b._parseView(g),layers:b._parseOlLayers(g)}),h.addOverlay(f),h.on("moveend",function(a){h.getTarget().style.cursor=""}),h.on("pointerdrag",function(a){h.getTarget().style.cursor="move"}),h.on("click",function(b){var c,d;d=h.getEventPixel(b.originalEvent),c=h.forEachFeatureAtPixel(d,function(a,b){return a}),c&&c.get("href")?a.ajax({url:c.get("href"),cache:!1,dataType:"html",success:function(c,d,g){var h,i;return h=a.parseHTML(c),h.length>1&&(h=a("<div>").html(h)),i=h.children("h1,h2,h3,h4,h5,h6").first(),i&&h.detach("h1:first,h2:first,h3:first,h4:first,h5:first,h6:first"),f.setPosition(b.coordinate),e.popover({placement:"top",html:"true",container:"body",content:h,title:i}),e.popover("show")},error:function(b,c,d){return $contentElement.html(a("<div>").attr({"class":"ol-popup-loading-error"}))}}):e.popover("destroy")}),h.on("pointermove",function(a){var b,c;a.dragging?h.getTarget().style.cursor="move":(c=h.getEventPixel(a.originalEvent),b=h.forEachFeatureAtPixel(c,function(a,b){return a}),b&&b.get("href")?h.getTarget().style.cursor="pointer":h.getTarget().style.cursor="")}),h}}(this))},b}(),function(){var b,c;b=function(){function b(b,c){var d,e;this.element=b,this.options=c,this.$element=a(this.element).setUniqueId(),this.elementId=this.$element.attr("id"),this.epsg4326=new ol.proj.get("EPSG:4326"),this.epsg3857=new ol.proj.get("EPSG:3857"),this.settings=a.extend(a.fn.jqOpenLayers.defaults,this.options),this.settings.coords=function(){var a,b,c,d;switch(!1){case!(null==this.settings.coords):return[0,0];case"string"!=typeof this.settings.coords:for(c=this.settings.coords.split(","),d=[],a=0,b=c.length;b>a;a++)e=c[a],d.push(parseFloat(e));return d;default:return this.settings.coords}}.call(this),null==(d=this.settings).zoom&&(d.zoom=1),this.map=null,this.mapView=null,this.$element}return b.prototype.initMapFromHtml=function(){return this.map=(new h).parseMap(this.$element)},b.prototype.initMap=function(){this.mapView=new ol.View({center:ol.proj.transform(this.settings.coords,this.epsg4326,this.epsg3857),zoom:this.settings.zoom}),this.map=new ol.Map({target:this.element,layers:[new ol.layer.Tile({source:new ol.source.MapQuest({layer:"osm"})})],view:this.mapView}),this.settings.address&&o.geocode(this.settings.address).then(function(b){return function(c){var d,e,f,g,h,i,j,k,l,m,n,o,p;return f=function(){var a,b,d,f;for(d=[c.lon,c.lat],f=[],a=0,b=d.length;b>a;a++)e=d[a],f.push(parseFloat(e));return f}(),d=function(){var a,b,d,f;for(d=[c.boundingbox[2],c.boundingbox[0],c.boundingbox[3],c.boundingbox[1]],f=[],a=0,b=d.length;b>a;a++)e=d[a],f.push(parseFloat(e));return f}(),console.debug("Address coords: lon="+f[0]+", lat="+f[1]),m=ol.proj.transform(f,b.epsg4326,b.mapView.getProjection()),l=ol.proj.transformExtent(d,b.epsg4326,b.mapView.getProjection()),console.debug(l),b.settings.marker&&"false"!==b.settings.marker&&(k="osm"===b.settings.marker?null!=(p=c.icon)?p:b.settings.markerIcon:"true"!==b.settings.marker?b.settings.marker:b.settings.markerIcon,g=new ol.Feature(a.extend({geometry:new ol.geom.Point(m),name:b.settings.address,displayName:c.display_name},c.extratags)),j=new ol.style.Style({image:new ol.style.Icon({anchor:[.5,1],anchorXUnits:"fraction",anchorYUnits:"fraction",opacity:.75,src:k})}),g.setStyle(j),i=new ol.source.Vector({features:[g]}),h=new ol.layer.Vector({source:i}),b.map.addLayer(h),o=a("<div>").appendTo(b.$element),n=new ol.Overlay({element:o,positioning:"bottom-center",stopEvent:!1}),b.map.addOverlay(n),b.map.on("click",function(a){g=b.map.forEachFeatureAtPixel(a.pixel,function(a,b){return a}),g?(n.setPosition(a.coordinate),o.popover({placement:"top",html:!0,container:"body",title:"<div style='overflow:hidden;text-overflow:ellipsis;white-space:nowrap'>"+g.get("name")+"</div>",content:g.get("displayName")}),o.popover("show")):o.popover("destroy")}),b.map.on("pointermove",function(a){var c,d;a.dragging?o.popover("destroy"):(d=b.map.getEventPixel(a.originalEvent),c=b.map.hasFeatureAtPixel(d),b.map.getTarget().style.cursor=c?"pointer":"")})),b.mapView.setCenter(m),b.mapView.fit(l,b.map.getSize())}}(this))},b.prototype.addJsonLayer=function(a){var b;this.map&&this.mapView&&(console.log("Adding json layer for '"+a+"'"),b=new ol.layer.Vector({source:new ol.source.Vector({url:a,format:new ol.format.GeoJSON({defaultProjection:"EPSG:4326"}),projection:"EPSG:3857"}),name:a}),this.map.addLayer(b))},b}(),c={initHtml:function(){var c,d;return c=a(this),d=new b(this,{}),c.data("JqOpenLayers",d),d.initMapFromHtml(),c},init:function(c){var d,e,f,g;return d=a(this),e={address:d.attr("data-address"),coords:d.attr("data-coords"),zoom:parseInt(d.attr("data-zoom"),10),marker:d.attr("data-marker"),markerIcon:d.attr("data-marker-icon")},g=a.extend(e,c),f=new b(this,g),d.data("JqOpenLayers",f),f.initMap(),d},addJsonLayer:function(b){var c,d;return c=a(this),d=c.data("JqOpenLayers"),d&&d.addJsonLayer(b),c}},a.fn.jqOpenLayers=function(b){var d;return d=arguments,console.log("("+b+"): Waiting for ol..."),o.loadOpenLayers().then(function(e){return function(){return console.log("("+b+"): ol should be available now!"),e.each(function(){return c[b]?c[b].apply(this,Array.prototype.slice.call(d,1)):"object"!=typeof b&&b?a.error("The method '"+b+"' does not exist on jQuery.jqOpenLayers"):c.init.apply(this,b)})}}(this))},a.fn.jqOpenLayers.defaults={address:null,coords:[0,0],zoom:1,marker:null,markerIcon:"http://openlayers.org/en/v3.8.2/examples/data/icon.png"}}(),a(function(){return a('[data-toggle="openlayers"]').jqOpenLayers("initHtml",{})})}).call(this);
//# sourceMappingURL=jquery-ol.min.js.map